<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Appointments</title>
</head>
<body>
  <h2>All Appointments</h2>
  <table border="1" id="appointmentsTable">
    <tr>
      <th>Name</th>
      <th>Email</th>
      <th>Date</th>
    </tr>
  </table>

  <script type="module">
    import { db } from "./firebase.js";
    import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const table = document.getElementById("appointmentsTable");

    async function loadAppointments() {
      const querySnapshot = await getDocs(collection(db, "appointments"));
      querySnapshot.forEach((doc) => {
        const data = doc.data();
        const row = table.insertRow();
        row.insertCell(0).innerText = data.name;
        row.insertCell(1).innerText = data.email;
        row.insertCell(2).innerText = data.date;
      });
    }

    loadAppointments();
  </script>
</body>
</html>

}
authArea.style.display = 'none';
panel.style.display = 'block';
loadAppointments();
}else{
authArea.style.display = 'block';
panel.style.display = 'none';
}
});


async function loadAppointments(){
appointmentsBody.innerHTML = '';
const snapshot = await db.collection('appointments').orderBy('createdAt','desc').get();
snapshot.forEach(doc=>{
const d = doc.data();
const tr = document.createElement('tr');
tr.innerHTML = `
<td>${escapeHtml(d.name || '')}<div class="small">${d.email || ''}</div></td>
<td>${d.phone || ''}</td>
<td>${d.date || ''} ${d.time || ''}</td>
<td>${escapeHtml(d.message || '')}</td>
<td><button data-id="${doc.id}" class="delBtn">Delete</button></td>
`;
appointmentsBody.appendChild(tr);
});
// attach delete handlers
document.querySelectorAll('.delBtn').forEach(btn=>{
btn.addEventListener('click', async ()=>{
const id = btn.getAttribute('data-id');
if(confirm('Delete this appointment?')){
await db.collection('appointments').doc(id).delete();
loadAppointments();
}
});
});
}


function escapeHtml(text){
return text.replace(/[&<>\"]/g, function(c){
return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c];
});
}
</script>
</body>
</html>
